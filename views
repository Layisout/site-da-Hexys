from django.shortcuts import render
from django.urls import reverse_lazy
from django.views.generic import CreateView
from django.contrib.auth.views import LoginView
from django.contrib.auth.forms import UserCreationForm

from .models import Match, Product

# View para a página inicial (mapeada para '/')
def index_view(request):
    """
    Exibe a página inicial com as próximas 5 partidas não finalizadas.
    """
    # Filtra as partidas não finalizadas e ordena pela data/hora
    upcoming_matches = Match.objects.filter(is_finished=False).order_by('match_date', 'match_time')[:5]
    
    context = {
        'matches': upcoming_matches
    }
    # Renderiza o template 'core/index.html'
    return render(request, 'core/index2.html', context)

# View para a página da loja (mapeada para '/loja/')
def store_view(request):
    """
    Exibe a página da loja, listando todos os produtos disponíveis.
    """
    # Passa todos os produtos disponíveis para o template
    products = Product.objects.filter(is_available=True)
    context = {
        'products': products
    }
    # Renderiza o template 'core/lojaoficial.html'
    return render(request, 'core/lojaoficial.html', context)

# View para a página do carrinho (mapeada para '/carrinho/')
def cart_view(request):
    """
    Exibe a página do carrinho. A lógica de armazenamento dos itens fica no JS (Local Storage).
    """
    # Renderiza o template 'core/carrinho.html'
    return render(request, 'core/carrinho.html')

# --- Views de Autenticação ---

# Login (mapeada para '/login/')
class CustomLoginView(LoginView):
    """
    Extende a view de Login padrão do Django.
    """
    # Define o template que será usado para o formulário de login
    template_name = 'core/paginalogin.html' 
    
# Cadastro (mapeada para '/cadastro/')
class RegisterView(CreateView):
    """
    Extende a view de Criação de Objeto, usando o formulário de criação de usuário do Django.
    """
    # Usa o formulário de criação de usuário padrão do Django (bom para iniciar)
    form_class = UserCreationForm
    # Define o template que será usado para o formulário de cadastro
    template_name = 'core/paginacadastro.html'
    # Redireciona para a página de login após um cadastro bem-sucedido
    success_url = reverse_lazy('paginalogin') 
    
# Recuperar Senha (mapeada para '/recuperar-senha/')
def password_reset_request_view(request):
    """
    Renderiza o template de recuperação de senha.
    A funcionalidade completa de envio de e-mail deve ser configurada separadamente.
    """
    # Renderiza o template 'core/recuperar_senha.html'
    return render(request, 'core/recuperaçãosenha.html')
